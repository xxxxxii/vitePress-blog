---
author: yulinZ
date: 2024-01-15
title: 前端热力图实现
postSlug: 前端热力图实现
featured: true
draft: false
tags:
  - 前端
  - js
  - 日常笔记
ogImage: ""
description: 热力图,heatmap.js
---

# 前端热力图实现

## 需求

展示监测点的可视化,x 轴为一天的时间,y 轴为监测点的数量,监测点的值形成热力图.

## 选型

1. 前端很多可视化框架都可以实现,例如: echarts,heightcharts 等,大致的效果也很类似,这里以 echarts 的热力图为例,官网有案例:[热力图](https://echarts.apache.org/examples/zh/editor.html?c=heatmap-large)

2. 没有采用 echarts 这些方案的原因是绘制出来的观感不好,看起来像马赛克.因为 echarts 绘制的是网格.
3. 最终采用了 heatmap.js

## 实现

这里直接贴代码

```html
<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" />
    <title>HeadMap.js</title>
    <!--Framework-->
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/heatmap.js/2.0.2/heatmap.min.js"></script>
    <style>
      body {
        display: flex;
        flex-direction: column;
        margin: 0;
        /* position: relative; */
      }

      .dialog-box {
        background: #fff;
        position: fixed;
        border-radius: 8px;
        padding: 10px;
        border: 1px solid #ced6e0;
        width: 250px;
      }

      .rules {
        display: flex;
        justify-content: space-between;
      }

      .tick {
        width: 1px;
        height: 4px;
        border-left: 1px solid red;
      }
    </style>
  </head>

  <body>
    <h1>HeadMap</h1>
    <div id="map-box" style="height: 150px;width: 1441px;position: relative;">
      <div class="heatmap" style="height: 150px;width: 1441px;"></div>
      <div class="rules" id="rules">
        <span></span>
      </div>
    </div>

    <script type="text/javascript">
      // minimal heatmap instance configuration
      var heatmapInstance = h337.create({
        // only container is required, the rest will be defaults
        //只需要一个container，也就是最终要绘制图形的dom节点，其他都默认
        container: document.querySelector(".heatmap"),
      });

      // now generate some random data
      var points = [];
      var max = 0;

      $.get("data.json", function (data) {
        let idx = 0;
        let max = 0;
        let min = null;
        let numList = [];
        let xData = [];

        for (let i in data) {
          if (!min) min = data[i][0];
          xData.push(i);
          data[i].map((item, index) => {
            let point = {
              x: idx,
              y: index,
              dateStr: i,
              value: item ? item : null,
              radius: 2,
            };
            numList.push(point.value);
            max < item ? (max = item) : "";
            min > item ? (min = item) : "";
            points.push(point);
          });
          idx++;
        }
        // heatmap data format
        var data = {
          max: max, //所有数据中的最大值
          min: min,
          data: points, //最终要展示的数据
        };
        // if you have a set of datapoints always use setData instead of addData
        heatmapInstance.setData(data);

        // 设置坐标尺
        let rTemp = "";
        xData.map((item, index) => {
          if (index % 44 === 0) {
            let dateRuleList = item.split(" ")[1].split(":");
            let dateRule = dateRuleList[0] + ":" + dateRuleList[1];
            rTemp += `<span style="font-size:12px"><div class="tick"></div> ${dateRule}</span>`;
          }
        });

        $("#rules").html(rTemp);
      });

      let canvas = document.querySelector(".heatmap");
      // let scaleNum = document.body.clientWidth / 1441
      // console.log(scaleNum)
      // canvas.style.transform = `scale(${scaleNum})`;
      // canvas.style.transform = `translate(-300px, 0px)`;

      // $(".heatmap").on("mousemove", function (evt) {
      //   // 在这里编写需要执行的操作或者显示相关内容
      //   console.log(evt);
      // });

      canvas.addEventListener("mousemove", function __handler__(evt) {
        var x = evt.clientX;
        var y = evt.clientY;
        var rect = canvas.getBoundingClientRect();
        x -= rect.left;
        y -= rect.top;
        // console.log(points); // (x, y) 就是鼠标在 canvas 单击时的坐标
        let point = points.filter(item => {
          return item.x == x && item.y == Math.floor(y);
        });

        $(".dialog-box").remove();
        if (point.length > 0) {
          htmlTemp = `<div class="dialog-box" style="left:${x}px;top:${y}px">时间: ${
            point[0]?.dateStr
          }</br>监测点:${point[0]?.y + 1}</br>监测值:${point[0]?.value}</div>`;
          canvas.style.cursor = "pointer";
          $("#map-box").append(htmlTemp);
          let dialogW = $(".dialog-box").width();
          if (x + 20 + dialogW > window.innerWidth) {
            $(".dialog-box").removeAttr("style");
            $(".dialog-box").css("left", x - 20 - dialogW + "px");
            $(".dialog-box").css("top", y + "px");
            $(".dialog-box").css("position", "fixed");
          }
        }
      });

      canvas.addEventListener("mouseleave", function __handler__(evt) {
        $(".dialog-box").remove();
      });
    </script>
  </body>
</html>
```

data.json 为模拟数据,格式如下: 数据太多,这里贴一部分

```json
{
  "2023-12-28 00:00:00": [
    109.15697016902911, 112.06344154592315, 112.8576341472593,
    115.29937533652925, 118.02014559486918, 120.84274908016668,
    117.8462148809689, 114.97625767824859, 112.29708058415915,
    109.48373739329494, 106.90024291414133, 104.40566405495312,
    104.23632246003267, 102.53301479929488, 104.88870737685937,
    106.38207032422932, 107.31961180769558, 110.28846269861046,
    110.74539576305796, 110.88355094260734, 113.00150914770826,
    115.15642898442869, 112.53454548540444, 110.47070471990952,
    107.57810518032665, 105.81011428440179, 108.20883784741399,
    110.24389724458462, 112.66037242282742, 113.8649482787003,
    115.15434263158252, 115.99752583387024, 114.53444521444784,
    115.75084405920117, 118.02694574832931, 118.09999902023436,
    120.96404820043503, 122.33999225153615, 123.55649200383618,
    120.64895750404715, 119.95210146242076, 119.93966790782511,
    119.24311271986625, 120.09147655889356, 122.11872773022847,
    123.34333361480462, 124.04073456629611, 124.67338916089147,
    126.29969080319815, 127.62245732157571, 129.10638277323156,
    132.08442587025843, 134.82420366088752, 137.52783729468794,
    140.40930447290455, 142.74896047810884, 144.21735049429736,
    143.09133807140788, 145.81276002513857, 146.78466373084507,
    148.33743210339594, 151.1045403391961, 149.18336314269553,
    147.2005629616083, 147.161389217054, 148.14801870173687, 145.96136354137548,
    145.85490045038796, 143.11581572339006, 144.51493265626203,
    147.10717028018792, 149.7380152225709, 151.48186272436186,
    153.48009871878557, 156.39157630027887, 157.21963983781234,
    158.7227980272354, 161.3322005768008, 161.417981506304, 162.85475503709395,
    165.09787264407245, 165.44153288936877, 165.7274287061086,
    168.63567453941803, 170.83500009132823, 170.67120039783583,
    167.96533979676363, 167.15876740183245, 165.35326911178123,
    164.91179387444316, 167.61815108348347, 169.6446883538324,
    170.3249682931312, 172.58909654082294, 172.36652837919812,
    169.44557062882714, 168.72705652682808, 167.98640186913562,
    170.11588145522333, 171.6869117415404, 173.8404800016025, 171.6614371937545,
    168.6645770748533, 167.42682869446136, 166.0396464535547,
    165.96347269053007, 163.7192349726624, 161.00767691311302,
    158.9818701864677, 156.75136089496715, 155.12220958607355,
    152.54635808376835, 149.75833523818199, 148.2612050830223,
    147.2113057134708, 146.20619338825466, 144.8682965424056,
    142.90222760864202, 144.22679519462946, 145.97451513653925,
    145.97581180040186, 143.53881642210646, 142.3316987094225, 142.000916520362,
    140.064299496348, 142.03789151439463, 140.5176857090853, 140.2257489569985,
    139.85049525447118, 136.86134275765406, 135.2474680691456,
    132.96634917172517, 130.44778914512776, 130.0372898599403,
    127.89562488928469, 129.48576664663634, 130.75446089161966,
    133.71271553141509, 135.39497880258924, 137.05214090602547,
    139.16675580860982, 139.22914234646697, 140.96374660157204,
    143.14352152417956, 145.98054349510406, 147.80951467702056,
    149.2456232102486, 151.37994568944654, 151.8043023016533, 152.51604462703884
  ],
  "2023-12-28 00:01:00": [
    111.6021315434425,
    113.93693260393903,
    115.64370759206906,
    113.23237989320972,
    111.3544018270721,
    112.39902689447895,
    111.96986610921834,
    113.79935203083382,
    112.73278325015261,
    111.52702325155616,
    110.72684691325992,
    112.15862582871814,
    111.46955198151068,
    111.84272095890424,
    113.15090491225558,
    112.50203847219545,
    111.93344060041666,
    112.25517525903818,
    111.34037686101894,
    112.35901440930746,
    115.03530242469272,
    114.5679205263461,
    114.68761595501888,
    113.49302460923836,
    112.50160627013183,
    113.40342440275,
    113.93986157222005,
    112.11484686605928,
    111.38453479506688,
    113.79549427563376,
    113.53955697570562,
    112.60980686777644,
    113.06857915106029,
    112.22689592317019,
    111.39966447570225,
    110.41149297307298,
    111.33397681884368,
    110.2807286034969,
    111.12404780091751,
    111.5968943735511,
    111.02992457201013,
    112.10207540987429,
    108.66572400778674,
    108.73924439423271,
    108.35218818919977,
    108.55622668847876,
    108.24639413248568,
    108.25082093132255,
    108.38100872410574,
    106.32804837742866,
    106.19479777090551,
    104.73920089915461,
    105.02879250688157,
    105.54099481861104,
    106.95000656148588,
    105.25653161886736,
    105.11225083813696,
    105.36220633890491,
    105.32650670140707,
    104.79831340194524,
    106.20236023922563,
    104.71803099497349,
    105.43843077898761,
    106.4494075313497,
    107.03515240696639,
    105.1255802929956,
    105.2284646380014,
    104.45041449896638,
    104.37931886473824,
    null,
    104.72332049186566,
    108.43387907037076,
    110.70220230253138,
    111.04261081882238,
    111.9351397429423,
    111.55998084081448,
    112.723478366594,
    112.63558947322129,
    112.50680176946533,
    111.53911965610669,
    111.04352671845712,
    111.44586383529273,
    109.84916276153685,
    107.04066909191457,
    107.67201684043708,
    107.26236411935963,
    108.1358181186852,
    107.70505838553616,
    106.30279252326011,
    105.9093358838871,
    104.63253873085537,
    106.38054410895788,
    105.11542608741074,
    107.10117902989143,
    106.81762466731107,
    106.67545715161444,
    105.95698280529207,
    105.92406951921716,
    106.77946623673108,
    107.90327382925241,
    105.67155255890361,
    106.42395224230182,
    110.18407211651183,
    111.42417646119657,
    110.97312319577149,
    111.1357277662389,
    110.25272676405433,
    112.23374628072146,
    113.4436654099528,
    112.60806123234711,
    115.21568196119605,
    112.8743020808413,
    113.74641862045814,
    114.95320572412265,
    114.40675099589704,
    114.45429881103955,
    112.05946367457203,
    111.19753046643602,
    110.29903619720602,
    109.85009531436438,
    112.46964721674063,
    114.74169392893535,
    116.15691546188789,
    114.68224300589145,
    114.43221929910501,
    115.6677283485436,
    110.59067413202571,
    108.07226441242892,
    106.40698710937656,
    105.51021218512282,
    105.86093104465101,
    104.7625381235888,
    104.51972193599977,
    103.91628411836973,
    105.02487571659336,
    106.2772596595969,
    107.65317919434455,
    107.44520053468054,
    105.80313658847788,
    106.0787636948506,
    105.92369787791999,
    105.96712990528529,
    105.40056135882543,
    106.10171513621891,
    106.98010502567259,
    105.55384746169318,
    106.8560493511058,
    107.68702688812174,
    109.61599771230519,
    109.12017128097159
  ]
}
```

## 最终效果![image-20240115172850733](https://gitee.com/yulinzhu/pic-window/raw/master/img/image-20240115172850733.png)
